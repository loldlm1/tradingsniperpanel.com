<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <meta charset="utf-8">
    <title><%= content_for(:title) || "#{t('app.name')} Dashboard" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "mosaic/css/vendors/flatpickr.min" %>
    <%= stylesheet_link_tag "mosaic/style" %>
    <%= stylesheet_link_tag "dashboard" %>
    <%= yield :head %>
  </head>
  <%= javascript_include_tag "theme" %>
  <body
    class="<%= content_for?(:body_class) ? yield(:body_class) : "font-inter antialiased bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-400" %>"
    :class="{ 'sidebar-expanded': sidebarExpanded }"
    x-data="{ sidebarOpen: false, sidebarExpanded: localStorage.getItem('sidebar-expanded') == 'true' }"
    x-init="$watch('sidebarExpanded', value => localStorage.setItem('sidebar-expanded', value))"
  >
    <% dashboard_user = current_user.is_a?(User) ? current_user : nil %>

    <div class="flex h-[100dvh] overflow-hidden">
      <div class="min-w-fit">
        <div
          class="fixed inset-0 bg-gray-900/30 z-40 lg:hidden lg:z-auto transition-opacity duration-200"
          :class="sidebarOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'"
          aria-hidden="true"
          x-cloak
        ></div>

        <div
          id="sidebar"
          class="flex flex-col absolute z-40 left-0 top-0 lg:static lg:left-auto lg:top-auto lg:translate-x-0 h-[100dvh] overflow-y-scroll lg:overflow-y-auto no-scrollbar w-64 lg:w-20 lg:sidebar-expanded:!w-64 2xl:!w-64 shrink-0 bg-white dark:bg-gray-800 shadow-xs rounded-r-2xl p-4 transition-all duration-200 ease-in-out"
          :class="sidebarOpen ? 'translate-x-0' : '-translate-x-64'"
          @click.outside="sidebarOpen = false"
          @keydown.escape.window="sidebarOpen = false"
          x-cloak="lg"
        >
          <div class="flex justify-between mb-10 pr-3 sm:px-2">
            <button class="lg:hidden text-gray-500 hover:text-gray-400" @click.stop="sidebarOpen = !sidebarOpen" aria-controls="sidebar" :aria-expanded="sidebarOpen">
              <span class="sr-only"><%= t("dashboard.sidebar.close_sidebar") %></span>
              <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.7 18.7l1.4-1.4L7.8 13H20v-2H7.8l4.3-4.3-1.4-1.4L4 12z" />
              </svg>
            </button>
            <%= link_to dashboard_path, class: "block", "aria-label": t("app.name") do %>
              <svg class="fill-violet-500" xmlns="http://www.w3.org/2000/svg" width="32" height="32">
                <path d="M31.956 14.8C31.372 6.92 25.08.628 17.2.044V5.76a9.04 9.04 0 0 0 9.04 9.04h5.716ZM14.8 26.24v5.716C6.92 31.372.63 25.08.044 17.2H5.76a9.04 9.04 0 0 1 9.04 9.04Zm11.44-9.04h5.716c-.584 7.88-6.876 14.172-14.756 14.756V26.24a9.04 9.04 0 0 1 9.04-9.04ZM.044 14.8C.63 6.92 6.92.628 14.8.044V5.76a9.04 9.04 0 0 1-9.04 9.04H.044Z" />
              </svg>
            <% end %>
          </div>

          <% dashboard_main_active = current_page?(dashboard_path) %>
          <% dashboard_analytics_active = current_page?(dashboard_analytics_path) %>
          <% partner_dashboard_active = current_page?(dashboard_partner_path) %>
          <% dashboard_group_active = dashboard_main_active || dashboard_analytics_active || partner_dashboard_active %>

          <% expert_advisors_group_active = controller_path == "expert_advisors" %>

          <% settings_account_active = current_page?(dashboard_settings_path) %>
          <% settings_plans_active = current_page?(dashboard_plans_path) %>
          <% settings_billing_active = current_page?(dashboard_billing_path) %>
          <% settings_support_active = current_page?(dashboard_support_path) %>
          <% settings_group_active = settings_account_active || settings_plans_active || settings_billing_active || settings_support_active %>

          <div class="space-y-8">
            <div>
              <h3 class="text-xs uppercase text-gray-400 dark:text-gray-500 font-semibold pl-3">
                <span class="hidden lg:block lg:sidebar-expanded:hidden 2xl:hidden text-center w-6" aria-hidden="true">•••</span>
                <span class="lg:hidden lg:sidebar-expanded:block 2xl:block"><%= t("dashboard.sidebar.pages") %></span>
              </h3>
              <ul class="mt-3">
                <li class="<%= mosaic_sidebar_li_classes(active: dashboard_group_active) %>" x-data="{ open: <%= dashboard_group_active ? 'true' : 'false' %> }">
                  <a class="<%= mosaic_sidebar_group_link_classes(active: dashboard_group_active) %>" href="#0" @click.prevent="open = !open; sidebarExpanded = true">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <svg class="<%= mosaic_sidebar_icon_classes(active: dashboard_group_active) %>" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                          <path d="M5.936.278A7.983 7.983 0 0 1 8 0a8 8 0 1 1-8 8c0-.722.104-1.413.278-2.064a1 1 0 1 1 1.932.516A5.99 5.99 0 0 0 2 8a6 6 0 1 0 6-6c-.53 0-1.045.076-1.548.21A1 1 0 1 1 5.936.278Z" />
                          <path d="M6.068 7.482A2.003 2.003 0 0 0 8 10a2 2 0 1 0-.518-3.932L3.707 2.293a1 1 0 0 0-1.414 1.414l3.775 3.775Z" />
                        </svg>
                        <span class="text-sm font-medium ml-4 lg:opacity-0 lg:sidebar-expanded:opacity-100 2xl:opacity-100 duration-200"><%= t("nav.dashboard") %></span>
                      </div>
                      <div class="flex shrink-0 ml-2 lg:opacity-0 lg:sidebar-expanded:opacity-100 2xl:opacity-100 duration-200">
                        <svg class="w-3 h-3 shrink-0 ml-1 fill-current text-gray-400 dark:text-gray-500" :class="open ? 'rotate-180' : 'rotate-0'" viewBox="0 0 12 12">
                          <path d="M5.9 11.4L.5 6l1.4-1.4 4 4 4-4L11.3 6z" />
                        </svg>
                      </div>
                    </div>
                  </a>
                  <div class="lg:hidden lg:sidebar-expanded:block 2xl:block">
                    <ul class="pl-8 mt-1" :class="open ? 'block!' : 'hidden'">
                      <li class="mb-1 last:mb-0">
                        <%= link_to dashboard_path, class: mosaic_sidebar_child_link_classes(active: dashboard_main_active) do %>
                          <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("dashboard.nav.main", default: "Main") %></span>
                        <% end %>
                      </li>
                      <li class="mb-1 last:mb-0">
                        <%= link_to dashboard_analytics_path, class: mosaic_sidebar_child_link_classes(active: dashboard_analytics_active) do %>
                          <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("dashboard.nav.analytics", default: "Analytics") %></span>
                        <% end %>
                      </li>
                      <% if dashboard_user&.partner? %>
                        <li class="mb-1 last:mb-0">
                          <%= link_to dashboard_partner_path, class: mosaic_sidebar_child_link_classes(active: partner_dashboard_active) do %>
                            <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("partner_dashboard.title", default: "Partner Dashboard") %></span>
                          <% end %>
                        </li>
                      <% end %>
                    </ul>
                  </div>
                </li>

                <li class="<%= mosaic_sidebar_li_classes(active: expert_advisors_group_active) %>" x-data="{ open: <%= expert_advisors_group_active ? 'true' : 'false' %> }">
                  <a class="<%= mosaic_sidebar_group_link_classes(active: expert_advisors_group_active) %>" href="#0" @click.prevent="open = !open; sidebarExpanded = true">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <svg class="<%= mosaic_sidebar_icon_classes(active: expert_advisors_group_active) %>" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                          <path d="M9 6.855A3.502 3.502 0 0 0 8 0a3.5 3.5 0 0 0-1 6.855v1.656L5.534 9.65a3.5 3.5 0 1 0 1.229 1.578L8 10.267l1.238.962a3.5 3.5 0 1 0 1.229-1.578L9 8.511V6.855ZM6.5 3.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm4.803 8.095c.005-.005.01-.01.013-.016l.012-.016a1.5 1.5 0 1 1-.025.032ZM3.5 11c.474 0 .897.22 1.171.563l.013.016.013.017A1.5 1.5 0 1 1 3.5 11Z" />
                        </svg>
                        <span class="text-sm font-medium ml-4 lg:opacity-0 lg:sidebar-expanded:opacity-100 2xl:opacity-100 duration-200"><%= t("dashboard.nav.expert_advisors", default: "Expert Advisors") %></span>
                      </div>
                      <div class="flex shrink-0 ml-2 lg:opacity-0 lg:sidebar-expanded:opacity-100 2xl:opacity-100 duration-200">
                        <svg class="w-3 h-3 shrink-0 ml-1 fill-current text-gray-400 dark:text-gray-500" :class="open ? 'rotate-180' : 'rotate-0'" viewBox="0 0 12 12">
                          <path d="M5.9 11.4L.5 6l1.4-1.4 4 4 4-4L11.3 6z" />
                        </svg>
                      </div>
                    </div>
                  </a>
                  <div class="lg:hidden lg:sidebar-expanded:block 2xl:block">
                    <ul class="pl-8 mt-1 hidden" :class="open ? 'block!' : 'hidden'">
                      <li class="mb-1 last:mb-0">
                        <%= link_to dashboard_expert_advisors_path, class: mosaic_sidebar_child_link_classes(active: current_page?(dashboard_expert_advisors_path)) do %>
                          <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("dashboard.nav.expert_advisors_all") %></span>
                        <% end %>
                      </li>
                      <% (@accessible_eas || []).each_with_index do |entry, idx| %>
                        <li class="mb-1 last:mb-0">
                          <% show_path = dashboard_expert_advisor_path(entry.expert_advisor, locale: I18n.locale) %>
                          <% guides_path = dashboard_expert_advisor_guides_path(entry.expert_advisor, locale: I18n.locale) %>
                          <% active_entry = current_page?(show_path) || current_page?(guides_path) %>
                          <%= link_to show_path, class: mosaic_sidebar_child_link_classes(active: active_entry) do %>
                            <span class="<%= mosaic_sidebar_child_span_classes %> flex items-center gap-2">
                              <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-100 text-gray-700 dark:bg-gray-700/60 dark:text-gray-100 text-[11px] font-semibold"><%= idx + 1 %></span>
                              <span class="truncate"><%= entry.expert_advisor.name %></span>
                            </span>
                          <% end %>
                        </li>
                      <% end %>
                    </ul>
                  </div>
                </li>

                <li class="<%= mosaic_sidebar_li_classes(active: settings_group_active) %>" x-data="{ open: <%= settings_group_active ? 'true' : 'false' %> }">
                  <a class="<%= mosaic_sidebar_group_link_classes(active: settings_group_active) %>" href="#0" @click.prevent="open = !open; sidebarExpanded = true">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <svg class="<%= mosaic_sidebar_icon_classes(active: settings_group_active) %>" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                          <path d="M10.5 1a3.502 3.502 0 0 1 3.355 2.5H15a1 1 0 1 1 0 2h-1.145a3.502 3.502 0 0 1-6.71 0H1a1 1 0 0 1 0-2h6.145A3.502 3.502 0 0 1 10.5 1ZM9 4.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM5.5 9a3.502 3.502 0 0 1 3.355 2.5H15a1 1 0 1 1 0 2H8.855a3.502 3.502 0 0 1-6.71 0H1a1 1 0 1 1 0-2h1.145A3.502 3.502 0 0 1 5.5 9ZM4 12.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0Z" fill-rule="evenodd" />
                        </svg>
                        <span class="text-sm font-medium ml-4 lg:opacity-0 lg:sidebar-expanded:opacity-100 2xl:opacity-100 duration-200"><%= t("dashboard.nav.settings") %></span>
                      </div>
                      <div class="flex shrink-0 ml-2 lg:opacity-0 lg:sidebar-expanded:opacity-100 2xl:opacity-100 duration-200">
                        <svg class="w-3 h-3 shrink-0 ml-1 fill-current text-gray-400 dark:text-gray-500" :class="open ? 'rotate-180' : 'rotate-0'" viewBox="0 0 12 12">
                          <path d="M5.9 11.4L.5 6l1.4-1.4 4 4 4-4L11.3 6z" />
                        </svg>
                      </div>
                    </div>
                  </a>
                  <div class="lg:hidden lg:sidebar-expanded:block 2xl:block">
                    <ul class="pl-8 mt-1 hidden" :class="open ? 'block!' : 'hidden'">
                      <li class="mb-1 last:mb-0">
                        <%= link_to dashboard_settings_path, class: mosaic_sidebar_child_link_classes(active: settings_account_active) do %>
                          <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("dashboard.nav.my_account") %></span>
                        <% end %>
                      </li>
                      <li class="mb-1 last:mb-0">
                        <%= link_to dashboard_plans_path, class: mosaic_sidebar_child_link_classes(active: settings_plans_active) do %>
                          <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("dashboard.nav.plans") %></span>
                        <% end %>
                      </li>
                      <li class="mb-1 last:mb-0">
                        <%= link_to dashboard_billing_path, class: mosaic_sidebar_child_link_classes(active: settings_billing_active) do %>
                          <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("dashboard.nav.billing_invoices") %></span>
                        <% end %>
                      </li>
                      <li class="mb-1 last:mb-0">
                        <%= link_to dashboard_support_path, class: mosaic_sidebar_child_link_classes(active: settings_support_active) do %>
                          <span class="<%= mosaic_sidebar_child_span_classes %>"><%= t("dashboard.nav.support") %></span>
                        <% end %>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden">
        <!-- Site header -->
        <header class="sticky top-0 before:absolute before:inset-0 before:backdrop-blur-md before:bg-white/90 dark:before:bg-gray-800/90 lg:before:bg-gray-100/90 dark:lg:before:bg-gray-900/90 before:-z-10 max-lg:shadow-xs z-30">
          <div class="px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 lg:border-b border-gray-200 dark:border-gray-700/60">
              <!-- Header: Left side -->
              <div class="flex">
                <!-- Hamburger button -->
                <button
                  class="text-gray-500 hover:text-gray-600 dark:hover:text-gray-400 lg:hidden"
                  @click.stop="sidebarOpen = !sidebarOpen"
                  aria-controls="sidebar"
                  :aria-expanded="sidebarOpen"
                >
                  <span class="sr-only"><%= t("dashboard.header.open_sidebar") %></span>
                  <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <rect x="4" y="5" width="16" height="2" />
                    <rect x="4" y="11" width="16" height="2" />
                    <rect x="4" y="17" width="16" height="2" />
                  </svg>
                </button>
              </div>

              <!-- Header: Right side -->
              <div class="flex items-center space-x-3">
                <!-- Language toggle -->
                <div class="relative inline-flex" x-data="{ open: false }">
                  <button
                    class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 lg:hover:bg-gray-200 dark:hover:bg-gray-700/50 dark:lg:hover:bg-gray-800 rounded-full"
                    aria-haspopup="true"
                    @click.prevent="open = !open"
                    :aria-expanded="open"
                  >
                    <span class="sr-only"><%= t("dashboard.header.language") %></span>
                    <svg class="fill-current text-gray-500/80 dark:text-gray-400/80" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                      <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0ZM2.05 7A6.03 6.03 0 0 1 6.3 2.34 9.94 9.94 0 0 0 5.3 7H2.05ZM2.05 9H5.3c.17 1.7.63 3.28 1 4.66A6.03 6.03 0 0 1 2.05 9ZM8 14a10.62 10.62 0 0 1-1.7-5H9.7A10.62 10.62 0 0 1 8 14Zm1.88-7H6.12A9.92 9.92 0 0 1 8 2a9.92 9.92 0 0 1 1.88 5ZM9.7 7c-.17-1.7-.63-3.28-1-4.66A6.03 6.03 0 0 1 13.95 7H9.7Zm.99 6.66c.37-1.38.83-2.96 1-4.66h3.25a6.03 6.03 0 0 1-4.25 4.66Z" />
                    </svg>
                  </button>
                  <div
                    class="origin-top-right z-10 absolute top-full right-0 min-w-44 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700/60 py-1.5 rounded-lg shadow-lg overflow-hidden mt-1"
                    @click.outside="open = false"
                    @keydown.escape.window="open = false"
                    x-show="open"
                    x-transition:enter="transition ease-out duration-200 transform"
                    x-transition:enter-start="opacity-0 -translate-y-2"
                    x-transition:enter-end="opacity-100 translate-y-0"
                    x-transition:leave="transition ease-out duration-200"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    x-cloak
                  >
                    <ul>
                      <li>
                        <%= link_to url_for(locale: :en), class: "font-medium text-sm #{I18n.locale == :en ? 'text-violet-500 dark:text-violet-400' : 'text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200'} flex items-center py-1 px-3" do %>
                          <span class="mr-2">EN</span>
                          <% if I18n.locale == :en %>
                            <svg class="w-3 h-3 fill-current text-violet-500 shrink-0 ml-auto" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
                              <path d="M10.28 2.28L3.99 8.58 1.7 6.28A1 1 0 0 0 .28 7.7l3 3a1 1 0 0 0 1.41 0l7-7a1 1 0 1 0-1.41-1.41Z" />
                            </svg>
                          <% end %>
                        <% end %>
                      </li>
                      <li>
                        <%= link_to url_for(locale: :es), class: "font-medium text-sm #{I18n.locale == :es ? 'text-violet-500 dark:text-violet-400' : 'text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200'} flex items-center py-1 px-3" do %>
                          <span class="mr-2">ES</span>
                          <% if I18n.locale == :es %>
                            <svg class="w-3 h-3 fill-current text-violet-500 shrink-0 ml-auto" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
                              <path d="M10.28 2.28L3.99 8.58 1.7 6.28A1 1 0 0 0 .28 7.7l3 3a1 1 0 0 0 1.41 0l7-7a1 1 0 1 0-1.41-1.41Z" />
                            </svg>
                          <% end %>
                        <% end %>
                      </li>
                    </ul>
                  </div>
                </div>

                <!-- Dark mode toggle -->
                <div>
                  <input type="checkbox" name="light-switch" id="light-switch" class="light-switch sr-only" />
                  <label class="flex items-center justify-center cursor-pointer w-8 h-8 hover:bg-gray-100 lg:hover:bg-gray-200 dark:hover:bg-gray-700/50 dark:lg:hover:bg-gray-800 rounded-full" for="light-switch">
                    <svg class="dark:hidden fill-current text-gray-500/80 dark:text-gray-400/80" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                      <path d="M8 0a1 1 0 0 1 1 1v.5a1 1 0 1 1-2 0V1a1 1 0 0 1 1-1Z"/>
                      <path d="M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0Zm-4 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                      <path d="M13.657 3.757a1 1 0 0 0-1.414-1.414l-.354.354a1 1 0 0 0 1.414 1.414l.354-.354ZM13.5 8a1 1 0 0 1 1-1h.5a1 1 0 1 1 0 2h-.5a1 1 0 0 1-1-1ZM13.303 11.889a1 1 0 0 0-1.414 1.414l.354.354a1 1 0 0 0 1.414-1.414l-.354-.354ZM8 13.5a1 1 0 0 1 1 1v.5a1 1 0 1 1-2 0v-.5a1 1 0 0 1 1-1ZM4.111 13.303a1 1 0 1 0-1.414-1.414l-.354.354a1 1 0 1 0 1.414 1.414l.354-.354ZM0 8a1 1 0 0 1 1-1h.5a1 1 0 0 1 0 2H1a1 1 0 0 1-1-1ZM3.757 2.343a1 1 0 1 0-1.414 1.414l.354.354A1 1 0 1 0 4.11 2.697l-.354-.354Z" />
                    </svg>
                    <svg class="hidden dark:block fill-current text-gray-500/80 dark:text-gray-400/80" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                      <path d="M11.875 4.375a.625.625 0 1 0 1.25 0c.001-.69.56-1.249 1.25-1.25a.625.625 0 1 0 0-1.25 1.252 1.252 0 0 1-1.25-1.25.625.625 0 1 0-1.25 0 1.252 1.252 0 0 1-1.25 1.25.625.625 0 1 0 0 1.25c.69.001 1.249.56 1.25 1.25Z" />
                      <path d="M7.019 1.985a1.55 1.55 0 0 0-.483-1.36 1.44 1.44 0 0 0-1.53-.277C2.056 1.553 0 4.5 0 7.9 0 12.352 3.648 16 8.1 16c3.407 0 6.246-2.058 7.51-4.963a1.446 1.446 0 0 0-.25-1.55 1.554 1.554 0 0 0-1.372-.502c-4.01.552-7.539-2.987-6.97-7ZM2 7.9C2 5.64 3.193 3.664 4.961 2.6 4.82 7.245 8.72 11.158 13.36 11.04 12.265 12.822 10.341 14 8.1 14 4.752 14 2 11.248 2 7.9Z" />
                    </svg>
                    <span class="sr-only"><%= t("dashboard.header.toggle_theme") %></span>
                  </label>
                </div>

                <!-- Divider -->
                <hr class="w-px h-6 bg-gray-200 dark:bg-gray-700/60 border-none" />

                <!-- User button -->
                <div class="relative inline-flex" x-data="{ open: false }">
                  <button
                    class="inline-flex justify-center items-center group"
                    aria-haspopup="true"
                    @click.prevent="open = !open"
                    :aria-expanded="open"
                  >
                    <%= image_tag "mosaic/images/avatar-01.jpg", class: "w-8 h-8 rounded-full", width: 32, height: 32, alt: t("dashboard.header.user_avatar_alt") %>
                    <div class="flex items-center truncate">
                      <span class="truncate ml-2 text-sm font-medium text-gray-600 dark:text-gray-100 group-hover:text-gray-800 dark:group-hover:text-white"><%= dashboard_user&.name.presence || dashboard_user&.email %></span>
                      <svg class="w-3 h-3 shrink-0 ml-1 fill-current text-gray-400 dark:text-gray-500" viewBox="0 0 12 12">
                        <path d="M5.9 11.4L.5 6l1.4-1.4 4 4 4-4L11.3 6z" />
                      </svg>
                    </div>
                  </button>
                  <div
                    class="origin-top-right z-10 absolute top-full right-0 min-w-44 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700/60 py-1.5 rounded-lg shadow-lg overflow-hidden mt-1"
                    @click.outside="open = false"
                    @keydown.escape.window="open = false"
                    x-show="open"
                    x-transition:enter="transition ease-out duration-200 transform"
                    x-transition:enter-start="opacity-0 -translate-y-2"
                    x-transition:enter-end="opacity-100 translate-y-0"
                    x-transition:leave="transition ease-out duration-200"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    x-cloak
                  >
                    <div class="pt-0.5 pb-2 px-3 mb-1 border-b border-gray-200 dark:border-gray-700/60">
                      <% role_label = dashboard_user&.role&.to_s&.titleize.presence || t("dashboard.header.role", default: "Administrator") %>
                      <div class="text-sm font-semibold text-gray-800 dark:text-gray-100"><%= dashboard_user&.name.presence || dashboard_user&.email %></div>
                      <div class="text-xs text-gray-500 dark:text-gray-400"><%= role_label %></div>
                    </div>
                    <ul>
                      <li>
                        <%= link_to dashboard_settings_path, class: "font-medium text-sm text-violet-500 hover:text-violet-600 dark:hover:text-violet-400 flex items-center py-1 px-3" do %>
                          <span><%= t("dashboard.nav.settings") %></span>
                        <% end %>
                      </li>
                      <li>
                        <%= button_to destroy_user_session_path,
                                      method: :delete,
                                      form: { class: "contents" },
                                      class: "font-medium text-sm text-violet-500 hover:text-violet-600 dark:hover:text-violet-400 flex items-center py-1 px-3" do %>
                          <span><%= t("nav.sign_out") %></span>
                        <% end %>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </header>

        <main class="grow">
          <% page_container_class = content_for?(:page_container_class) ? content_for(:page_container_class) : "px-4 sm:px-6 lg:px-8 py-8 w-full max-w-[96rem] mx-auto" %>
          <div class="<%= page_container_class %>">
            <%= render "shared/alert" %>
            <%= yield %>
          </div>
        </main>
      </div>
    </div>

    <%= javascript_importmap_tags %>
  	<%= javascript_include_tag "dashboard" %>
    <%= javascript_include_tag "mosaic/js/vendors/alpinejs.min", defer: true %>
    <%= javascript_include_tag "mosaic/js/vendors/chart.js" %>
    <%= javascript_include_tag "mosaic/js/vendors/moment.js" %>
    <%= javascript_include_tag "mosaic/js/vendors/chartjs-adapter-moment.js" %>
    <%= javascript_include_tag "mosaic/js/dashboard-charts" %>
    <%= javascript_include_tag "mosaic/js/vendors/flatpickr" %>
    <%= javascript_include_tag "mosaic/js/flatpickr-init" %>
    <%= javascript_include_tag "mosaic/js/main", defer: true %>
    <%= yield :scripts if content_for?(:scripts) %>
  </body>
</html>
