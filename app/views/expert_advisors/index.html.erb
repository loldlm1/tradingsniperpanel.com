<% content_for :title, "#{t('app.short_name')} - #{t('dashboard.expert_advisors.index.title')}" %>

<div class="sm:flex sm:justify-between sm:items-center mb-8">
  <div class="mb-4 sm:mb-0">
    <h1 class="text-2xl md:text-3xl text-gray-800 dark:text-gray-100 font-bold"><%= t("dashboard.expert_advisors.index.title") %></h1>
    <p class="text-sm text-gray-500 dark:text-gray-400"><%= t("dashboard.expert_advisors.index.subtitle") %></p>
  </div>
</div>

<div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3">
  <% (@accessible_eas || []).each do |entry| %>
    <% ea = entry.expert_advisor %>
    <% badge_class = case entry.status
                    when :active then "bg-emerald-100 text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-100"
                    when :trial then "bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-100"
                    else "bg-gray-100 text-gray-700 dark:bg-gray-700/60 dark:text-gray-200"
                    end %>
    <div class="bg-white dark:bg-gray-800 shadow-xs rounded-xl border border-gray-200 dark:border-gray-700 p-5 flex flex-col justify-between">
      <div class="space-y-2">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100"><%= ea.name %></h2>
          <span class="px-2 py-1 rounded-full text-xs font-semibold <%= badge_class %>"><%= entry.status.to_s.humanize %></span>
        </div>
        <p class="text-sm text-gray-500 dark:text-gray-400"><%= ea.description %></p>
        <div class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold"><%= ea.ea_type %></div>
        <% if entry.accessible && entry.license_key.present? %>
          <div class="mt-2">
            <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1"><%= t("dashboard.license_key", default: "License Key") %></div>
            <div class="flex items-center gap-2 text-xs bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2">
              <span class="truncate"><%= entry.license_key %></span>
              <button type="button" class="text-violet-600 dark:text-violet-300 font-semibold" onclick="navigator.clipboard && navigator.clipboard.writeText('<%= j entry.license_key %>')"><%= t('dashboard.copy', default: 'Copy') %></button>
            </div>
            <% if entry.expires_at.present? %>
              <div class="text-xs text-gray-500 dark:text-gray-400 mt-1"><%= t("dashboard.expires_at", default: "Expires") %>: <%= l(entry.expires_at, format: :short) %></div>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="mt-4 flex items-center justify-between">
        <%= link_to t("nav.docs"), dashboard_expert_advisor_docs_path(ea, locale: I18n.locale), class: "text-violet-600 hover:text-violet-800 dark:text-violet-300 dark:hover:text-violet-100 text-sm font-semibold" %>
        <% unless entry.accessible %>
          <% tier = entry.allowed_tiers.first %>
          <% cta_key = "#{tier}_monthly" %>
          <%= link_to t("dashboard.pricing.cta.subscribe"), dashboard_pricing_path(price_key: cta_key), class: "btn-xs bg-gray-900 text-white hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
