<% content_for :title, t("dashboard.expert_advisors.guides_page_title", name: @expert_advisor.name, app: t("app.short_name")) %>
<% content_for :body_class, "font-aspekta antialiased font-[350] bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-400" %>
<% content_for :page_container_class, "w-full max-w-none px-0 py-0" %>
<% content_for :head do %>
  <%= stylesheet_link_tag "docs/style" %>
<% end %>

<% entry = @expert_advisor_entry %>
<% allowed_tier = Array(@expert_advisor.allowed_subscription_tiers).presence&.first || Billing::DashboardPlan::TIERS.first %>
<% cta_key = "#{allowed_tier}_monthly" %>
<% status = entry&.status || :locked %>
<% badge_class = case status
                when :active then "bg-emerald-100 text-emerald-700"
                when :trial then "bg-amber-100 text-amber-700"
                else "bg-slate-200 text-slate-700 dark:bg-slate-800 dark:text-slate-200"
                end %>

<div class="relative isolate overflow-hidden">
  <div class="absolute top-0 left-1/2 -translate-x-1/2 pointer-events-none -z-10" aria-hidden="true">
    <%= image_tag "docs/images/hero-illustration.svg", class: "max-w-none", width: 1972, height: 392, alt: "" %>
  </div>

  <div class="px-4 sm:px-6 lg:px-8 pt-8 pb-8 md:pt-12">
    <div class="w-full max-w-[96rem] mx-auto">
      <article>
        <div class="min-w-0">
          <header class="mb-6">
            <div class="flex items-start justify-between gap-4 flex-wrap">
              <div>
                <h1 class="h2 text-slate-800 mb-2 dark:text-slate-200"><%= @expert_advisor.name %></h1>
                <p class="text-lg text-slate-600 dark:text-slate-400"><%= @expert_advisor.description %></p>
              </div>
              <div class="flex items-center gap-2">
                <span class="px-2 py-1 rounded-full text-xs font-semibold <%= badge_class %>"><%= status.to_s.humanize %></span>
                <% unless entry&.accessible %>
                  <%= link_to t("dashboard.plans.cta.subscribe"), dashboard_plans_path(price_key: cta_key), class: "btn-sm inline-flex items-center text-slate-100 bg-blue-600 hover:bg-blue-700 shadow-xs" %>
                <% end %>
              </div>
            </div>
          </header>

          <% if @markdown_html.present? %>
            <div class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-5">
              <div
                class="ea-guide-content text-slate-600 dark:text-slate-400 space-y-6"
                data-scrollspy-container
                data-copy-label="<%= t("dashboard.expert_advisors.copy_code") %>"
                data-copied-label="<%= t("dashboard.expert_advisors.copied") %>"
              >
                <div x-data="{ modalExpanded: false }">
                  <div class="relative inline-flex justify-center items-center my-2">
                    <%= image_tag "docs/images/content-image-01.jpg", class: "rounded-sm", width: 680, height: 382, alt: t("dashboard.expert_advisors.guide_video_alt") %>
                    <button class="absolute group" @click.prevent="modalExpanded = true" aria-controls="guide-video-modal">
                      <svg class="w-16 h-16 fill-current sm:w-20 sm:h-20" viewBox="0 0 88 88" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <circle class="text-white opacity-80 group-hover:opacity-100 transition duration-150 ease-in-out" cx="44" cy="44" r="44" />
                        <path class="text-blue-600" d="M52 44a.999.999 0 00-.427-.82l-10-7A1 1 0 0040 37V51a.999.999 0 001.573.82l10-7A.995.995 0 0052 44V44c0 .001 0 .001 0 0z" />
                      </svg>
                      <span class="sr-only"><%= t("dashboard.expert_advisors.guide_video_open") %></span>
                    </button>
                  </div>

                  <div
                    class="fixed inset-0 bg-slate-900/20 z-50 transition-opacity"
                    x-show="modalExpanded"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100"
                    x-transition:leave="transition ease-out duration-100"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    aria-hidden="true"
                    x-cloak
                  ></div>

                  <div
                    id="guide-video-modal"
                    class="fixed inset-0 z-50 overflow-hidden flex items-center justify-center px-4 sm:px-6"
                    role="dialog"
                    aria-modal="true"
                    aria-labelledby="guide-video-modal-title"
                    x-show="modalExpanded"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 scale-95"
                    x-transition:enter-end="opacity-100 scale-100"
                    x-transition:leave="transition ease-out duration-200"
                    x-transition:leave-start="opacity-100 scale-100"
                    x-transition:leave-end="opacity-0 scale-95"
                    x-cloak
                  >
                    <div class="bg-white overflow-auto max-w-4xl w-full max-h-full dark:bg-slate-900" @click.away="modalExpanded = false" @keydown.escape.window="modalExpanded = false">
                      <h2 id="guide-video-modal-title" class="sr-only"><%= t("dashboard.expert_advisors.guide_video_title") %></h2>
                      <video x-init="$watch('modalExpanded', value => value ? $el.play() : $el.pause())" class="w-full aspect-video" width="1920" height="1080" loop controls>
                        <source src="<%= asset_path("docs/videos/video.mp4") %>" type="video/mp4" />
                        <%= t("dashboard.expert_advisors.video_fallback") %>
                      </video>
                    </div>
                  </div>
                </div>

                <%= @markdown_html %>
              </div>
            </div>
          <% else %>
            <p class="text-slate-600 dark:text-slate-400"><%= t("dashboard.expert_advisors.guides_missing") %></p>
          <% end %>
        </div>
      </article>
    </div>
  </div>
</div>
